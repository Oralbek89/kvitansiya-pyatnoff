<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<title>Квитанция химчистки</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
</style>
</head>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 40px auto;
      padding: 20px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    h2 {
      text-align: center;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      box-sizing: border-box;
    }
    .field-block {
      margin-top: 20px;
    }
  </style>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><style>
    body {
        font-size: 16px;
        padding: 10px;
        font-family: sans-serif;
    }

    input, select, textarea, button {
        font-size: 18px !important;
        padding: 10px !important;
        width: 100%;
        box-sizing: border-box;
        margin-bottom: 12px;
    }

    label {
        font-weight: bold;
        margin-top: 10px;
        display: block;
    }

    @media (min-width: 768px) {
        input, select, textarea, button {
            max-width: 600px;
        }
    }

    canvas {
        border: 1px solid #ccc;
        display: block;
        margin-bottom: 12px;
    }
    </style></head>
<body>

<h2 style="text-align: center; margin-top: 20px;">Квитанция химчистки «Пятн.OFF»</h2>
<form method="POST" action="https://oralbek.app.n8n.cloud/webhook-test/fdbc0125-89ca-4117-8188-7e677e1d972b"><div class="field-block"><label for="receiptNumber">1. Номер квитанции</label><input id="receiptNumber" name="receiptNumber" required="True" type="text"/></div>
<!-- Дата приема -->
<div class="field-block">
<label for="date">2. Дата приёма</label>
<input id="date" name="date" required="" type="date"/>
</div>
<!-- ФИО клиента -->
<div class="field-block">
<label for="clientName">3. ФИО клиента</label>
<input id="clientName" name="clientName" placeholder="Введите ФИО" required="" type="text"/>
</div><div class="field-block">
<label for="phone">4. Телефон</label>
<input id="phone" name="phone" placeholder="+7 (___) ___-__-__" required="" type="tel"/>
</div><div class="field-block">
<label for="address">5. Адрес</label>
<input id="address" name="address" placeholder="Введите адрес клиента" type="text"/>
</div>
<!-- Наименование изделия -->
<div class="field-block">
<label for="itemName">6. Наименование изделия</label>
<select id="itemName" name="itemName" onchange="toggleOther(this, 'itemNameOther')">
<option disabled="" selected="" value="">Выберите...</option>
<option>Пальто</option>
<option>Куртка</option>
<option>Брюки</option>
<option>Джинсы</option>
<option>Пиджак</option>
<option>Рубашка</option>
<option>Платок</option>
<option>Шторы</option>
<option>Юбка</option>
<option>Платье</option>
<option>Костюм</option>
<option>Комбинезон</option>
<option>Спецодежда</option>
<option>Пуховик</option>
<option value="Другое">Другое</option>
</select>
<input id="itemNameOther" name="itemNameOther" placeholder="Укажите другое" style="display:none; margin-top:5px;" type="text"/>
</div>
<!-- Цвет изделия -->
<div class="field-block">
<label for="itemColor">7. Цвет изделия</label>
<select id="itemColor" name="itemColor" onchange="toggleOther(this, 'itemColorOther')">
<option disabled="" selected="" value="">Выберите...</option>
<option>Чёрный</option>
<option>Белый</option>
<option>Синий</option>
<option>Красный</option>
<option>Бежевый</option>
<option>Серый</option>
<option>Зелёный</option>
<option>Жёлтый</option>
<option>Розовый</option>
<option>Бордовый</option>
<option>Хаки</option>
<option>Многоцветный</option>
<option value="Другое">Другое</option>
</select>
<input id="itemColorOther" name="itemColorOther" placeholder="Укажите другое" style="display:none; margin-top:5px;" type="text"/>
</div>
<!-- Пятна и загрязнение изделия -->
<div class="field-block">
<label for="stains">8. Пятна и загрязнение изделия</label>
<select id="stains" name="stains" onchange="toggleOther(this, 'stainsOther')">
<option disabled="" selected="" value="">Выберите...</option>
<option>Вино</option>
<option>Кофе</option>
<option>Трава</option>
<option>Жир</option>
<option>Кровь</option>
<option>Шоколад</option>
<option>Чернила</option>
<option>Краска</option>
<option>Грунт</option>
<option>Пищевые продукты</option>
<option>Плесень</option>
<option>Неизвестного происхождения</option>
<option>Старое пятно</option>
<option>Пытались вывести дома</option>
<option value="Другое">Другое</option>
</select>
<input id="stainsOther" name="stainsOther" placeholder="Укажите другое" style="display:none; margin-top:5px;" type="text"/>
</div>
<!-- Возможные последствия после чистки -->
<div class="field-block">
<label for="risks">9. Возможные последствия после чистки</label>
<select id="risks" name="risks" onchange="toggleOther(this, 'risksOther')">
<option disabled="" selected="" value="">Выберите...</option>
<option>Усадка</option>
<option>Осветление цвета</option>
<option>Деформация</option>
<option>Повреждение фурнитуры</option>
<option>Усиление износа</option>
<option>Риск порчи пятна</option>
<option>Без последствий</option>
<option value="Другое">Другое</option>
</select>
<input id="risksOther" name="risksOther" placeholder="Укажите другое" style="display:none; margin-top:5px;" type="text"/>
</div>
<!-- Телефон -->
<!-- Адрес -->
<!-- Стоимость чистки -->
<!-- Скидка -->
<!-- Итоговая сумма с учетом скидки -->
<!-- Оплата -->
<!-- Степень износа изделия -->
<div class="field-block">
<label for="wearLevel">10. Степень износа изделия</label>
<select id="wearLevel" name="wearLevel">
<option>Новая</option>
<option>Слегка ношена</option>
<option>Средний износ</option>
<option>Сильный износ</option>
</select>
</div>
<!-- Модель: мужская или женская -->
<div class="field-block">
<label for="gender">11. Модель</label>
<select id="gender" name="gender">
<option>Мужская</option>
<option>Женская</option>
<option>Унисекс</option>
</select>
</div>
<!-- Название бренда -->
<div class="field-block">
<label for="brand">12. Название бренда</label>
<input id="brand" name="brand" type="text"/>
</div>
<!-- Маркировка -->
<div class="field-block">
<label for="labeling">13. Наличие или отсутствие маркировки</label>
<select id="labeling" name="labeling">
<option>Полная маркировка</option>
<option>Отсутствует</option>
<option>Частичная</option>
<option>Некорректная</option>
<option>Все виды чистки запрещены</option>
<option>Аквачистка</option>
<option>Химчистка</option>
<option>Паровая обработка</option>
</select>
</div>
<!-- Прочие детали изделия -->
<div class="field-block">
<label for="details">14. Прочие детали изделия</label>
<input id="details" name="details" type="text"/>
</div>
<!-- Дефекты изделия -->
<div class="field-block">
<label for="defects">15. Наличие дефектов изделия</label>
<input id="defects" name="defects" type="text"/>
</div>
<!-- Общее количество единиц -->
<div class="field-block">
<label for="quantity">16. Общее количество единиц</label>
<input id="quantity" min="1" name="quantity" type="number"/>
</div>
<!-- Подпись заказчика и исполнителя -->
<!-- Подпись клиента о получении заказа -->
<!-- Дата выдачи -->
<div class="field-block">
<label for="issueDate">17. Дата выдачи</label>
<input id="issueDate" name="issueDate" type="date"/>
</div>
<!-- Доставка -->
<div class="field-block">
<label for="delivery">18. Доставка</label>
<select id="delivery" name="delivery">
<option>Без доставки</option>
<option>Туда и обратно</option>
<option>Только забор</option>
<option>Только доставка</option>
</select>
</div>
<button onclick="submitForm()" style="margin-top: 20px; padding: 10px 15px;" type="button">Сохранить и отправить</button>
<button style="margin-top: 10px; padding: 10px 15px;" type="reset">Сброс / Очистка формы</button>
<div class="field-block">
<label>19. Подпись клиента ✍️</label>
<canvas height="100" id="clientSign" style="border:1px solid #ccc;" width="300"></canvas>
<button onclick="clearCanvas('clientSign')" type="button">Очистить</button>
</div>
<div class="field-block">
<div class="field-block">
<label>20. ФИО исполнителя</label>
<input id="staffName" name="staffName" placeholder="Введите ФИО исполнителя" type="text"/>
</div>
<label>21. Подпись исполнителя ✍️</label>
<canvas height="100" id="staffSign" style="border:1px solid #ccc;" width="300"></canvas>
<button onclick="clearCanvas('staffSign')" type="button">Очистить</button>
</div>
<div class="field-block"><label for="price">22. Стоимость чистки (тг)</label><input id="price" min="0" name="price" step="0.01" type="number"/></div><div class="field-block"><label for="advance">23. Аванс (тг)</label><input id="advance" min="0" name="advance" step="0.01" type="number"/></div><div class="field-block"><label for="discount">24. Скидка (%)</label><input id="discount" max="100" min="0" name="discount" placeholder="Введите скидку, например 10" step="1" type="number"/></div><div class="field-block"><label for="express">25. Экспресс-чистка (доплата, тг)</label><input id="express" min="0" name="express" step="1" type="number"/></div><div class="field-block"><label for="comment">26. Комментарий</label><textarea id="comment" name="comment" placeholder="Введите дополнительные пожелания или комментарии" rows="3"></textarea></div><div class="field-block"><label for="finalAmount">27. Итоговая сумма к оплате</label><input id="finalAmount" name="finalAmount" readonly="True" type="text"/></div></form>
<button onclick="generateAndSendPDF()" type="button" style="margin-top: 10px; padding: 10px 15px;">Скачать PDF и отправить</button>
 <script>
  window.onload = function () {
    function calculateTotal() {
      const priceEl = document.getElementById('price');
      const discountEl = document.getElementById('discount');
      const finalAmountEl = document.getElementById('finalAmount');

      if (!priceEl || !discountEl || !finalAmountEl) return;

      const price = parseFloat(priceEl.value) || 0;
      let discountRaw = discountEl.value.replace('%', '').trim();
      const discount = parseFloat(discountRaw) || 0;

      const discountedAmount = price * (discount / 100);
      const finalAmount = price - discountedAmount;

      finalAmountEl.value = finalAmount.toFixed(2) + " тг";
    }

    const priceInput = document.getElementById('price');
    const discountInput = document.getElementById('discount');

    if (priceInput) priceInput.addEventListener('input', calculateTotal);
    if (discountInput) discountInput.addEventListener('input', calculateTotal);
  }
</script>
<script>
  window.onload = function () {
    function calculateTotal() {
      const priceEl = document.getElementById('price');
      const discountEl = document.getElementById('discount');
      const finalAmountEl = document.getElementById('finalAmount');

      if (!priceEl || !discountEl || !finalAmountEl) return;

      const price = parseFloat(priceEl.value) || 0;
      let discountRaw = discountEl.value.replace('%', '').trim();
      const discount = parseFloat(discountRaw) || 0;

      const discountedAmount = price * (discount / 100);
      const finalAmount = price - discountedAmount;

      finalAmountEl.value = finalAmount.toFixed(2) + " тг";
    }

    const priceInput = document.getElementById('price');
    const discountInput = document.getElementById('discount');

    if (priceInput) priceInput.addEventListener('input', calculateTotal);
    if (discountInput) discountInput.addEventListener('input', calculateTotal);
  }
</script>
<script>
  function submitForm() {
    const form = document.querySelector("form");
    const formData = new FormData(form);
    const data = {};

    formData.forEach((value, key) => {
      data[key] = value;
    });

    // Добавим HTML формы и telegram_id
    data["htmlContent"] = form.outerHTML;
    data["telegram_id"] = "@cleanbot_astana_bot";
// Добавим подписи в base64
const clientSignCanvas = document.getElementById('clientSign');
const staffSignCanvas = document.getElementById('staffSign');

if (clientSignCanvas && staffSignCanvas) {
  data["clientSignature"] = clientSignCanvas.toDataURL("image/png");
  data["staffSignature"] = staffSignCanvas.toDataURL("image/png");
}
    fetch("https://oralbek.app.n8n.cloud/webhook-test/fdbc0125-89ca-4117-8188-7e677e1d972b", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(data)
    })
    .then(response => {
      if (response.ok) {
        alert("Данные успешно отправлены в n8n!");
      } else {
        alert("Ошибка при отправке данных.");
      }
    })
    .catch(error => {
      console.error("Ошибка:", error);
      alert("Ошибка соединения.");
    });
  }
</script>
<script>
  function enableSignature(canvasId) {
    const canvas = document.getElementById(canvasId);
    const ctx = canvas.getContext("2d");
    let drawing = false;

    canvas.addEventListener("mousedown", (e) => {
      drawing = true;
      ctx.beginPath();
      ctx.moveTo(e.offsetX, e.offsetY);
    });

    canvas.addEventListener("mousemove", (e) => {
      if (drawing) {
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.stroke();
      }
    });

    canvas.addEventListener("mouseup", () => {
      drawing = false;
    });

    canvas.addEventListener("mouseleave", () => {
      drawing = false;
    });
  }

  function clearCanvas(canvasId) {
    const canvas = document.getElementById(canvasId);
    const ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  window.onload = function () {
    enableSignature("clientSign");
    enableSignature("staffSign");

    const priceEl = document.getElementById('price');
    const discountEl = document.getElementById('discount');
    const finalAmountEl = document.getElementById('finalAmount');

    function calculateTotal() {
      const price = parseFloat(priceEl.value) || 0;
      let discountRaw = discountEl.value.replace('%', '').trim();
      const discount = parseFloat(discountRaw) || 0;
      const discountedAmount = price * (discount / 100);
      const finalAmount = price - discountedAmount;
      finalAmountEl.value = finalAmount.toFixed(2) + " тг";
    }

    if (priceEl) priceEl.addEventListener('input', calculateTotal);
    if (discountEl) discountEl.addEventListener('input', calculateTotal);
  }
</script>
<script>
function calculateTotal() {
  const price = parseFloat(document.getElementById('price').value) || 0;
  const discount = parseFloat(document.getElementById('discount').value) || 0;
  const express = parseFloat(document.getElementById('express').value) || 0;
  const advance = parseFloat(document.getElementById('advance').value) || 0;

  let discounted = price * (1 - discount / 100);
  let total = discounted + express - advance;
  document.getElementById('finalAmount').value = total.toFixed(2);
}

['price', 'discount', 'advance', 'express'].forEach(id => {
  const el = document.getElementById(id);
  if (el) el.addEventListener('input', calculateTotal);
});
</script><footer style="text-align:center; margin-top:30px; font-size:14px; color:#888;">© Химчистка «Пятн.OFF». Все права защищены.</footer>
<script>
async function generateAndSendPDF() {
  const element = document.body;

  const opt = {
    margin:       0.5,
    filename:     'Квитанция.pdf',
    image:        { type: 'jpeg', quality: 0.98 },
    html2canvas:  { scale: 2 },
    jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
  };

  // Генерируем PDF
  const pdfBlob = await html2pdf().set(opt).from(element).outputPdf('blob');

  // Собираем данные из формы
  const form = document.querySelector("form");
  const formData = new FormData(form);
  const data = {};
  formData.forEach((value, key) => data[key] = value);

  // Добавим подписи
  const clientSignCanvas = document.getElementById('clientSign');
  const staffSignCanvas = document.getElementById('staffSign');
  if (clientSignCanvas && staffSignCanvas) {
    data["clientSignature"] = clientSignCanvas.toDataURL("image/png");
    data["staffSignature"] = staffSignCanvas.toDataURL("image/png");
  }

  // Готовим payload
  const payload = new FormData();
  payload.append("pdf", pdfBlob, "Квитанция.pdf");
  payload.append("json", JSON.stringify(data));

  // Отправка в n8n
  await fetch("https://your-n8n-webhook-url", {
    method: "POST",
    body: payload
  });

  alert("PDF и данные отправлены!");
}
</script>
</body>
</html>
